/*

  _  ____ _           _   
 (_)/ ___| |__   __ _| |_
 | | |   | '_ \ / _` | __|
 | | |___| | | | (_| | |_
 |_|\____|_| |_|\__,_|\__|
  _____ _____ _____ _____
 |_____|_____|_____|_____|
 by _iPhoenix_

 Interested in looking
 under the hood, or just
 want to poke around?
 Start here:
 http://bit.ly/iChat-Source 
*/
'use strict';function f(b){const a=document.createElement("p");a.innerText=b;return a.innerHTML}
class k{constructor(){this.h=this.g=this.version=null;this.b=!1;this.a=[];this.c=[];"complete"===document.readyState||"loaded"===document.readyState?this.load():document.addEventListener("DOMContentLoaded",()=>this.load())}set l(b){this.b?b():this.c.push(b)}m(){console.group("iChat Plugin Listing");this.a.forEach(b=>{console.log(b.name+": "+b.v)});console.groupEnd()}f(b){const a=b.j,d=b.name;if("function"==typeof a&&1===a.length)if(d&&!this.a.find(c=>c.name==d))if(b instanceof m)this.a.push(b);else throw Error('Cannot register non-plugin "'+
d+'"!');else throw Error('Invalid plugin name "'+d+'", or plugin is a duplicate.');else throw Error('Plugin "'+d+'" has an invalid parser.');}o(...b){b.forEach(a=>this.f(a))}i(b){if(b.txt){const d=document.createElement("p");d.classList.add("iChat");d.classList.add("iChat-message");d.style.margin="0";const c="iChat-message-"+(Math.random()+(new Date).getTime()).toString(36);d.id=c;if(b.ts){var a=document.createElement("span");a.classList.add("iChat");a.classList.add("iChat-timestamp");a.innerText=
(new Date(b.ts)).toLocaleTimeString();d.appendChild(a)}b.u&&(a=document.createElement("span"),a.classList.add("iChat"),a.classList.add("iChat-username"),a.innerText=b.u,d.appendChild(a));a=document.createElement("span");a.classList.add("iChat");a.classList.add("iChat-text");a.innerText=b.txt;d.appendChild(a);b.txt.includes(firebase.auth().currentUser.displayName.substring(0,4))&&d.classList.add("iChat-highlight");b=document.getElementById("iChat-messages");b.insertBefore(d,b.firstChild);return c}return""}s(b,
a){if(b=document.getElementById(b))a.ts&&(b.children[0].innerText=(new Date(a.ts)).toLocaleTimeString()),a.u&&(b.children[1].innerText=a.u),a.txt&&(b.children[2].innerText=a.txt)}async load(){if(!this.b){fetch("https://legend-of-iphoenix.github.io/iChat/version.json").then(a=>a.json()).then(a=>{this.version=a.version;this.g=a.releaseDate;this.h=a.releaseNotes;setTimeout(()=>{this.b=!0;console.log("iChat loaded.\n\u00a9 _iPhoenix_.\n\nVersion "+this.version+", released on "+this.g+". \nRelease notes: \n"+
this.h+"\nInterested in looking under the hood, or just want to poke around? Start here: http://bit.ly/iChat-Source");this.c.forEach(d=>d());firebase.database().ref("iChat").orderByChild("ts").limitToLast(15).on("child_added",d=>{let c=d.val();c.txt=f(c.txt);c.u=f(c.u);this.a.forEach(e=>{c=e.j(c)});this.i({u:c.u,ts:c.ts,txt:c.txt})})},500)});const b=document.getElementById("iChat-input");b.onkeydown=a=>{let d=b.value;("Enter"==a.key||13==a.keyCode||13==a.which)&&128>d.length&&2<=d.length&&(firebase.database().ref("iChat").push({u:firebase.auth().currentUser.displayName,
ts:firebase.database.ServerValue.TIMESTAMP,txt:d}),b.value="")}}}}const p=new k;window.iChat=p;Object.defineProperty(window.iChat,"onload",{set(b){p.l=b}});window.iChat.registerPlugin=p.f;window.iChat.registerPlugins=p.o;window.iChat.listPlugins=p.m;window.iChat.renderMessage=p.i;window.iChat.updateMessage=p.s;class m{constructor(b,a,...d){this.name=b;this.j=a;this.v=d}}window.iChatPlugin=m;
(()=>{const b=new m("default/links",c=>{let e="";if(void 0!==c.txt&&null!==c.txt){let l="",g=c.txt.match(/https?:\/\/[A-Za-z0-9\.\-\/?&+=;:%#_~]+/g);if(g){for(let h=0;h<g.length;h++){const q='<a href="'+g[h]+'">'+g[h]+"</a>",n=c.txt.substring(l.length,c.txt.indexOf(g[h]));l+=n+g[h];e=e.concat(n);e=e.concat(q)}e+=c.txt.substring(l.length,c.txt.length)}else e=c.txt}else e="";c.txt=e;return c},"Written by _iPhoenix_, using code from UniChat."),a=new m("default/italics",c=>{c.txt=c.txt.replace(/~([^~]*)~/g,
'<em style="display: inline-block;">$1</em>');return c},"Written by _iPhoenix_, using code from UniChat."),d=new m("default/bold",c=>{c.txt=c.txt.replace(/\*([^~]*)\*/g,'<strong style="display: inline-block;">$1</strong>');return c},"Written by _iPhoenix_, using code from UniChat.");window.iChat.onload=function(){window.iChat.registerPlugins(b,a,d)}})();
