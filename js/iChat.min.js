/* 
 _  ____ _           _   
(_)/ ___| |__   __ _| |_
| | |   | '_ \ / _` | __|
| | |___| | | | (_| | |_
|_|\____|_| |_|\__,_|\__|
 _____ _____ _____ _____
|_____|_____|_____|_____|

  © _iPhoenix_
Interested in looking
under the hood, or just
want to poke around?
Start here:
http://bit.ly/iChat-Source
*/
var iChat=new function(){this.callbacks=[],this.isTemp=!0,Object.defineProperty(this,"onload",{set(t){iChat.callbacks.push(t)}})};function iChatPlugin(t,e,...n){this.name=t,this.parser=e,this.otherInfo=n}document.addEventListener("DOMContentLoaded",t=>{if(iChat.isTemp){var e=iChat.callbacks;function n(t){var e=document.createElement("p");return e.innerText=t,e.innerHTML}iChat=new function(){this.version=null,this.isLoaded=!1,this.plugins=[],this.registerPlugin=function(t){var e=t.parser;"function"!=typeof e||1!==e.length||iChat.plugins.find(t=>t.name===e.name)||t.constructor!=iChatPlugin||iChat.plugins.push(t)},this.registerPlugins=function(...t){t.forEach(function(t){var e=t.parser;"function"!=typeof e||1!==e.length||iChat.plugins.find(t=>t.name===e.name)||t.constructor!=iChatPlugin||iChat.plugins.push(t)})},Object.defineProperty(this,"onload",{set(t){iChat.isLoaded?t():iChat.callbacks.push(t)}}),fetch("https://legend-of-iphoenix.github.io/iChat/README.md").then(function(t){return t.text()}).then(function(t){iChat.version=t.match(/N: ([^)]*)\)/)[0].substring(3).slice(0,-1),iChat.releaseDate=t.match(/E: ([^)]*)\)/)[0].substring(3).slice(0,-1),setTimeout(t=>{var n=document.createElement("iframe");n.src="https://legend-of-iphoenix.github.io/iChat/test.html?"+location.href,n.width="1px",n.height="1px",document.body.appendChild(n),setTimeout(t=>n.remove(),1e3),iChat.isLoaded=!0,console.log("iChat loaded.\n© _iPhoenix_.\n\nVersion "+iChat.version+", released on "+iChat.releaseDate+". \nInterested in looking under the hood, or just want to poke around? Start here: http://bit.ly/iChat-Source"),e.forEach(t=>t())},1e3)})},document.getElementById("iChat-input").onkeydown=function(t){"Enter"!=t.key&&13!=t.keyCode&&13!=t.which||document.getElementById("iChat-input").value.length<128&&document.getElementById("iChat-input").value.length>=2&&(firebase.database().ref("iChat").push({u:firebase.auth().currentUser.displayName,ts:firebase.database.ServerValue.TIMESTAMP,txt:document.getElementById("iChat-input").value}),document.getElementById("iChat-input").value="")},firebase.database().ref("iChat").orderByChild("ts").limitToLast(15).on("child_added",function(t){var e=t.val();e.txt=n(e.txt),e.u=n(e.u),iChat.plugins.forEach(function(t){e=t.parser(e)});var i=new Date(e.ts).toLocaleTimeString(),a=document.createElement("p");a.classList="iChat iChat-message",a.style.margin="0",a.innerHTML="[<span class='iChat iChat-timestamp'>"+i+'</span>] <span class="iChat iChat-username">'+e.u+'</span>: <span class="iChat iChat-text">'+e.txt+"</span>",-1!==e.txt.indexOf(firebase.auth().currentUser.displayName.substring(0,4))&&(a.classList+=" iChat-highlight"),document.getElementById("iChat-messages").insertBefore(a,document.getElementById("iChat-messages").childNodes[0])})}}),function(){var t="Written by _iPhoenix_, using code from UniChat.",e=new iChatPlugin("default/links",function(t){if(void 0!==t.txt&&null!==t.txt){var e="",n="",i=new RegExp("https?:\\/\\/[A-Za-z0-9\\.\\-\\/?&+=;:%#_~]+","g"),a=t.txt.match(i);if(a){for(var s=0;s<a.length;s++){var h='<a href="'+a[s]+'">'+a[s]+"</a>",r=t.txt.indexOf(a[s]),o=t.txt.substring(n.length,r);n+=o,n+=a[s],e=(e=e.concat(o)).concat(h)}e+=t.txt.substring(n.length,t.txt.length)}else e=t.txt}else e="";return t.txt=e,t},t),n=new iChatPlugin("default/italics",function(t){return t.txt=t.txt.replace(/\~([^\~]*)\~/g,'<em style="display: inline-block;">$1</em>'),t},t),i=new iChatPlugin("default/bold",function(t){return t.txt=t.txt.replace(/\*([^\~]*)\*/g,'<strong style="display: inline-block;">$1</strong>'),t},t);iChat.onload=function(){iChat.registerPlugins(e,n,i)}}();