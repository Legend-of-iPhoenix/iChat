/* 
 _  ____ _           _   
(_)/ ___| |__   __ _| |_
| | |   | '_ \ / _` | __|
| | |___| | | | (_| | |_
|_|\____|_| |_|\__,_|\__|
 _____ _____ _____ _____
|_____|_____|_____|_____|

      © _iPhoenix_
Interested in looking
under the hood, or just
want to poke around?
Start here:
http://bit.ly/iChat-Source
*/
var iChat=new function(){this.callbacks=[],this.isLoaded=!1,Object.defineProperty(this,"onload",{set(t){iChat.callbacks.push(t)}})};function iChatPlugin(t,e,...n){this.name=t,this.parser=e,this.otherInfo=n}document.addEventListener("DOMContentLoaded",t=>{if(!iChat.isLoaded){var e=iChat.callbacks;iChat=new function(){this.version=null,this.releaseDate=null,this.releaseNotes=null,this.isLoaded=!1,this.plugins=[],this.listPlugins=function(){console.group("iChat Plugin Listing"),iChat.plugins.forEach(function(t){console.log(t.name+": "+t.otherInfo)}),console.groupEnd()},this.registerPlugin=function(t){var e=t.parser;if("function"!=typeof e||1!==e.length||iChat.plugins.find(e=>e.name===t.name)||t.constructor!==iChatPlugin)throw new Error("Invalid iChat plugin!");iChat.plugins.push(t)},this.registerPlugins=function(...t){t.forEach(t=>iChat.registerPlugin(t))},this.removePlugin=function(t){var e=iChat.plugins.find(e=>e.name==t);return iChat.plugins=iChat.plugins.filter(e=>e.name!=t),e},this.renderMessage=function(t){if(t.txt){var e=document.createElement("p");e.classList="iChat iChat-message",e.style.margin="0",e.innerHTML=(t.ts?"[<span class='iChat iChat-timestamp'>"+new Date(t.ts).toLocaleTimeString()+"</span>] ":"")+(t.u?'<span class="iChat iChat-username">'+t.u+"</span>:":"")+'  <span class="iChat iChat-text">'+t.txt+"</span>",-1!==t.txt.indexOf(firebase.auth().currentUser.displayName.substring(0,4))&&(e.classList+=" iChat-highlight"),document.getElementById("iChat-messages").insertBefore(e,document.getElementById("iChat-messages").childNodes[0])}},Object.defineProperty(this,"onload",{set(t){iChat.isLoaded?t():iChat.callbacks.push(t)}}),fetch("https://legend-of-iphoenix.github.io/iChat/version.json").then(function(t){return t.json()}).then(function(t){iChat.version=t.version,iChat.releaseDate=t.releaseDate,iChat.releaseNotes=t.releaseNotes,setTimeout(t=>{iChat.isLoaded=!0,console.log("iChat loaded.\n© _iPhoenix_.\n\nVersion "+iChat.version+", released on "+iChat.releaseDate+". \nRelease notes: \n"+iChat.releaseNotes+"\nInterested in looking under the hood, or just want to poke around? Start here: http://bit.ly/iChat-Source"),e.forEach(t=>t()),firebase.database().ref("iChat").orderByChild("ts").limitToLast(15).on("child_added",function(t){var e=t.val();function n(t){var e=document.createElement("p");return e.innerText=t,e.innerHTML}e.txt=n(e.txt),e.u=n(e.u),iChat.plugins.forEach(function(t){e=t.parser(e)}),iChat.renderMessage(e)})},500)})},document.getElementById("iChat-input").onkeydown=function(t){"Enter"!=t.key&&13!=t.keyCode&&13!=t.which||document.getElementById("iChat-input").value.length<128&&document.getElementById("iChat-input").value.length>=2&&(firebase.database().ref("iChat").push({u:firebase.auth().currentUser.displayName,ts:firebase.database.ServerValue.TIMESTAMP,txt:document.getElementById("iChat-input").value}),document.getElementById("iChat-input").value="")}}}),(()=>{var t="Written by _iPhoenix_, using code from UniChat.",e=new iChatPlugin("default/links",function(t){if(void 0!==t.txt&&null!==t.txt){var e="",n="",i=new RegExp("https?:\\/\\/[A-Za-z0-9\\.\\-\\/?&+=;:%#_~]+","g"),a=t.txt.match(i);if(a){for(var s=0;s<a.length;s++){var r='<a href="'+a[s]+'">'+a[s]+"</a>",o=t.txt.indexOf(a[s]),l=t.txt.substring(n.length,o);n+=l,n+=a[s],e=(e=e.concat(l)).concat(r)}e+=t.txt.substring(n.length,t.txt.length)}else e=t.txt}else e="";return t.txt=e,t},t),n=new iChatPlugin("default/italics",function(t){return t.txt=t.txt.replace(/\~([^\~]*)\~/g,'<em style="display: inline-block;">$1</em>'),t},t),i=new iChatPlugin("default/bold",function(t){return t.txt=t.txt.replace(/\*([^\~]*)\*/g,'<strong style="display: inline-block;">$1</strong>'),t},t);iChat.onload=function(){iChat.registerPlugins(e,n,i)}})();