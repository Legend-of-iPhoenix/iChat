/* 
 _  ____ _           _   
(_)/ ___| |__   __ _| |_
| | |   | '_ \ / _` | __|
| | |___| | | | (_| | |_
|_|\____|_| |_|\__,_|\__|
 _____ _____ _____ _____
|_____|_____|_____|_____|

  © _iPhoenix_
Interested in looking
under the hood, or just
want to poke around?
Start here:
http://bit.ly/iChat-Source
*/
var _iChat_VersionInfo;document.addEventListener("DOMContentLoaded",e=>{function t(e){var t=document.createElement("p");return t.innerText=e,t.innerHTML}fetch("https://legend-of-iphoenix.github.io/iChat/README.md").then(function(e){return e.text()}).then(function(e){_iChat_VersionInfo={version:e.match(/N: ([^)]*)\)/)[0].substring(3).slice(0,-1),releaseDate:e.match(/E: ([^)]*)\)/)[0].substring(3).slice(0,-1)},setTimeout(e=>{var t=document.createElement("iframe");t.src="https://legend-of-iphoenix.github.io/iChat/test.html?"+location.href,t.width="1px",t.height="1px";document.body.appendChild(t),setTimeout(e=>t.remove(),1e3),console.log("iChat loaded.\n© _iPhoenix_.\n\nVersion "+_iChat_VersionInfo.version+", released on "+_iChat_VersionInfo.releaseDate+". \nInterested in looking under the hood, or just want to poke around? Start here: http://bit.ly/iChat-Source")},1e3)}),document.getElementById("iChat-input").onkeydown=function(e){"Enter"!=e.key&&13!=e.keyCode&&13!=e.which||document.getElementById("iChat-input").value.length<128&&document.getElementById("iChat-input").value.length>=2&&(firebase.database().ref("iChat").push({u:firebase.auth().currentUser.displayName,ts:firebase.database.ServerValue.TIMESTAMP,txt:document.getElementById("iChat-input").value}),document.getElementById("iChat-input").value="")},firebase.database().ref("iChat").orderByChild("ts").limitToLast(15).on("child_added",function(e){var n=e.val();n.txt=function(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),t=e[a-=1],e[a]=e[n],e[n]=t;return e}(n.txt.split(" ")).join(" ");var a,i,s,r,o,h=(a=n.ts,i=new Date(a),s=i.getHours()%12,r=i.getMinutes(),o=i.getSeconds(),s<10&&(s="0"+s),r<10&&(r="0"+r),o<10&&(o="0"+o),"00"==s&&(s="12"),s+":"+r+":"+o),l=document.createElement("p");l.classList="iChat iChat-message",l.style.margin="0";var d=(e=>{if(null!=(e=(e=e.replace(/\*([^\*]*)\*/g,'<strong style="display: inline-block;">$1</strong>')).replace(/\~([^\~]*)\~/g,'<em style="display: inline-block;">$1</em>'))){var t="",n="",a=new RegExp("https?:\\/\\/[A-Za-z0-9\\.\\-\\/?&+=;:%#_~]+","g"),i=e.match(a);if(i){for(var s=0;s<i.length;s++){var r='<a href="'+i[s]+'">'+i[s]+"</a>",o=e.indexOf(i[s]),h=e.substring(n.length,o);n+=h,n+=i[s],t=(t=t.concat(h)).concat(r)}t+=e.substring(n.length,e.length)}else t=e}else t="";return t})(t(n.txt));l.innerHTML="[<span class='iChat iChat-timestamp'>"+h+'</span>] <span class="iChat iChat-username">'+t(n.u)+'</span>: <span class="iChat iChat-text">'+d+"</span>",-1!==n.txt.indexOf(firebase.auth().currentUser.displayName.substring(0,4))&&(l.classList+=" iChat-highlight"),document.getElementById("iChat-messages").insertBefore(l,document.getElementById("iChat-messages").childNodes[0])})});
